<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø³ÙŠØªÙŠ Ù‡Ø§ÙŠØ¨Ø± - Supabase</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --city-red: #e63946;
            --hyper-black: #1a1a1a;
            --white: #ffffff;
            --bg-light: #f8f9fa;
        }

        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            display: flex;
            background-color: var(--bg-light);
            min-height: 100vh;
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .sidebar {
            width: 260px;
            background-color: var(--hyper-black);
            color: white;
            height: 100vh;
            position: fixed;
            padding: 20px 0;
            z-index: 1000;
        }

        .sidebar h2 {
            color: var(--city-red);
            text-align: center;
            font-weight: 900;
            margin-bottom: 30px;
        }

        .nav-item {
            width: 100%;
            padding: 15px 25px;
            border: none;
            background: none;
            color: white;
            text-align: right;
            font-family: 'Cairo';
            cursor: pointer;
            display: block;
            font-size: 1rem;
            transition: 0.3s;
        }

        .nav-item:hover, .nav-item.active {
            background-color: var(--city-red);
        }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-content {
            margin-right: 260px;
            padding: 40px;
            width: 100%;
            box-sizing: border-box;
        }

        .admin-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            max-width: 800px;
            margin: 0 auto;
        }

        .admin-section.active {
            display: block;
        }

        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 700; }
        input, select { 
            width: 100%; padding: 12px; border: 1px solid #ddd; 
            border-radius: 8px; font-family: 'Cairo'; box-sizing: border-box;
        }

        .price-row { display: flex; gap: 20px; }
        .price-row .form-group { flex: 1; }

        .preview-img {
            max-width: 150px; margin-top: 10px; border-radius: 8px;
            display: none; border: 2px solid var(--city-red);
        }

        .btn-submit {
            background-color: var(--city-red);
            color: white; border: none; padding: 12px 30px;
            border-radius: 8px; cursor: pointer; font-weight: 700;
            width: 100%; font-family: 'Cairo';
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .toast {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 2000;
            transition: 0.5s;
            opacity: 0;
            transform: translateX(-100%);
        }
        .toast.show { opacity: 1; transform: translateX(0); }
        .toast.success { background-color: #2ecc71; }
        .toast.error { background-color: #e63946; }

        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar {
                width: 100%; height: auto; position: relative;
                padding: 10px 0; display: flex; flex-direction: row;
                overflow-x: auto; white-space: nowrap;
            }
            .sidebar h2 { display: none; }
            .main-content { margin-right: 0; padding: 20px; }
            .price-row { flex-direction: column; gap: 0; }
        }
    </style>
</head>
<body>

    <div id="toast" class="toast"></div>

    <aside class="sidebar">
        <h2>Ø³ÙŠØªÙŠ Ø¢Ø¯Ù…Ù† âš™ï¸</h2>
        <button class="nav-item active" onclick="showSection('banners', this)">ğŸ–¼ï¸ Ø§Ù„Ø¨Ù†Ø±Ø§Øª</button>
        <button class="nav-item" onclick="showSection('categories', this)">ğŸ“‚ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</button>
        <button class="nav-item" onclick="showSection('products', this)">ğŸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
    </aside>

    <main class="main-content">
        <section id="banners" class="admin-section active">
            <h3>Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø± Ø¥Ø¹Ù„Ø§Ù†ÙŠ ğŸ–¼ï¸</h3>
            <div class="form-group">
                <label>Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ø¨Ù†Ø±:</label>
                <input type="file" id="bannerFile" accept="image/*" onchange="preview(this, 'p1')">
                <img id="p1" class="preview-img">
            </div>
            <button class="btn-submit" onclick="saveBanner()">Ø­ÙØ¸ Ø§Ù„Ø¨Ù†Ø± âœ…</button>
        </section>

        <section id="categories" class="admin-section">
            <h3>Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ Ø¬Ø¯ÙŠØ¯ ğŸ“‚</h3>
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
                <input type="text" id="catName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ù…Ù†Ø¸ÙØ§Øª">
            </div>
            <button class="btn-submit" onclick="saveCategory()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù…</button>
        </section>

        <section id="products" class="admin-section">
            <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ ğŸ</h3>
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
                <input type="text" id="prodName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø²ÙŠØª Ù‚Ù„ÙŠ">
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ù‚Ø³Ù…:</label>
                <select id="dynamicCats">
                    <option value="">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…...</option>
                </select>
            </div>
            <div class="price-row">
                <div class="form-group">
                    <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…:</label>
                    <input type="number" id="oldPrice" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>
                    <input type="number" id="newPrice" placeholder="0.00">
                </div>
            </div>
            <div class="form-group">
                <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬:</label>
                <input type="file" id="prodFile" accept="image/*" onchange="preview(this, 'p2')">
                <img id="p2" class="preview-img">
            </div>
            <button class="btn-submit" onclick="saveProduct()">Ù†Ø´Ø± Ø§Ù„Ø¹Ø±Ø¶ ğŸš€</button>
        </section>
    </main>

    <script>
        const supabaseUrl = 'https://lluxexpussqaigzqmdii.supabase.co';
        const supabaseKey = 'sb_publishable_Gp8P3aKK3I2zf3PppaiR4w_nknZVUyA';
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ---
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.innerText = message;
            toast.className = `toast show ${type}`;
            setTimeout(() => { toast.className = 'toast'; }, 3000);
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ---
        function showSection(id, btn) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        }

        function preview(input, imgId) {
            const img = document.getElementById(imgId);
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => { 
                    img.src = e.target.result; 
                    img.style.display = 'block'; 
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø±Ø¨Ø· ---

        async function uploadImage(file, bucketPath) {
            const fileName = `${Date.now()}_${file.name}`;
            const { data, error } = await _supabase.storage
                .from('images')
                .upload(`${bucketPath}/${fileName}`, file);

            if (error) throw error;
            const { data: { publicUrl } } = _supabase.storage
                .from('images')
                .getPublicUrl(`${bucketPath}/${fileName}`);

            return publicUrl;
        }

        async function saveCategory() {
            const name = document.getElementById('catName').value;
            if (!name) return showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…", "error");

            const { error } = await _supabase.from('categories').insert([{ name }]);
            if (error) {
                showToast("ÙØ´Ù„Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©: " + error.message, "error");
            } else {
                showToast("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰");
                document.getElementById('catName').value = "";
                loadCategories();
            }
        }

        async function saveProduct() {
            const name = document.getElementById('prodName').value;
            const catId = document.getElementById('dynamicCats').value;
            const oldP = document.getElementById('oldPrice').value;
            const newP = document.getElementById('newPrice').value;
            const file = document.getElementById('prodFile').files[0];

            if (!name || !newP || !file || !catId) return showToast("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„", "error");

            try {
                const imageUrl = await uploadImage(file, 'products');
                const { error } = await _supabase.from('products').insert([{
                    name,
                    old_price: oldP || null,
                    new_price: newP,
                    image_url: imageUrl,
                    category_id: catId
                }]);
                if (error) throw error;
                showToast("ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­! ğŸš€");
            } catch (err) { 
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message, "error"); 
            }
        }

        async function loadCategories() {
            const { data, error } = await _supabase.from('categories').select('*');
            const select = document.getElementById('dynamicCats');
            if (data) {
                select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…...</option>';
                data.forEach(c => { select.innerHTML += `<option value="${c.id}">${c.name}</option>`; });
            }
        }

        async function saveBanner() {
            const file = document.getElementById('bannerFile').files[0];
            if (!file) return showToast("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©", "error");
            try {
                const imageUrl = await uploadImage(file, 'banners');
                const { error } = await _supabase.from('banners').insert([{ image_url: imageUrl }]);
                if (error) throw error;
                showToast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨Ù†Ø± Ø¨Ù†Ø¬Ø§Ø­! âœ…");
            } catch (err) { 
                showToast(err.message, "error"); 
            }
        }

        loadCategories();
    </script>
</body>
</html>

